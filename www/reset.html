<div class="row connected_content out-of-sight"
    style="margin: 0px !important; z-index: 20; position:absolute; text-align:center; border:none !important; width:100%;  overflow-y: auto;"
    id="reset">
    <div class="col-0 col-sm-0 col-md-1 col-lg-2">
    </div>
    <form class="col-12 col-sm-12 col-md-10 col-lg-8">
        <br>
        <h1 style="text-align:center; color:#0f0; font-size: 14px !important; width:auto; background-color: rgba(0,0,0,.75); border-radius: 12px; border: 1px solid #fff !important;"
            class="blink-white">
            <br>
            Create or change the password for your account below:
            <br>
            <br>
        </h1>
        <h1
            style="text-align:center; color:#fff; font-size: 14px !important; width:auto; background-color: rgba(0,0,0,.75); border-radius: 12px; border: 1px solid #fff !important;">
            <br>
            By (re)setting your password you agree to our privacy policy:
            <br>
            <br>

            <div style="text-align: center;">
                <button type="button" class="btn btn-outline-primary mx-auto"
                    onclick="state.show_page(pages.POLICY);">View
                    Privacy Policy</button>
            </div>
            <br>
            A valid password has at least one number, at least one letter, and at least six characters.
            <br>
            <br>
            <div style="display: inline-block; text-align:center; color:#fff; font-size: 14px !important; width:50%;">
                Password
            </div>
            <input autocomplete="username" type="text" style="display: none; font-size: 14px !important; width:40%;"
                class="form-control" id="hidden_username1" placeholder="">
            <input autocomplete="new-password" type="password"
                style="display: inline-block; font-size: 14px !important; width:40%;" class="form-control"
                id="reset_password" placeholder="New Password">
            <br>
            <br>
            <div style="display: inline-block; text-align:center; color:#fff; font-size: 14px !important; width:50%;">
                Re-type Password
            </div>
            <input autocomplete="username" type="text" style="display: none; font-size: 14px !important; width:40%;"
                class="form-control" id="hidden_username2" placeholder="">
            <input autocomplete="new-password" type="password"
                style="display: inline-block; font-size: 14px !important; width:40%;" class="form-control"
                id="reset_retype" placeholder="New Password">
            <br>
            <br>
            <div style="display: inline-block; text-align:center; min-width:50%; max-height:50% !important;">
                <img style="display: inline-block; text-align:center; color:#fff; font-size: 14px !important; max-width:50%;"
                    id="reset_captcha">
            </div>
            <input type="text" style="display: inline-block; font-size: 14px !important; width:40%;"
                class="form-control" id="reset_captcha_input" placeholder="Captcha">
            <br>
            <br>

            <button type="button" class="btn btn-outline-success mx-auto" onclick="state.set_password()">Set
                Password</button>
            <br>
            <br>
        </h1>
        </table>
    </form>
    <div class="col-0 col-sm-0 col-md-1 col-lg-2">
    </div>
</div>

<script>
    //Utility function
    function getQueryVariable(variable) {
        var query = window.location.search.substring(1);
        var vars = query.split('&');
        for (var i = 0; i < vars.length; i++) {
            var pair = vars[i].split('=');
            if (decodeURIComponent(pair[0]) == variable) {
                return decodeURIComponent(pair[1]);
            }
        }
        return null;
    }


    GlobalState.prototype.set_password = function () {
        var pwd = $("#reset_password").val()
        if (pwd != $("#reset_retype").val()) {
            this.show_page(pages.CLIENT_ERROR, "Error!", "Please enter passwords that match. Use at least one number, at least one letter, and at least six characters.", true);
            return;
        }
        var valid_pwd = /(?=.*\d)(?=.*[a-zA-Z]).{6,}/.test(pwd);
        if (!valid_pwd) {
            this.show_page(pages.CLIENT_ERROR, "Error!", "Please enter a valid password. Use at least one number, at least one letter, and at least six characters.", true);
            return;
        }

        var captcha = $("#reset_captcha_input").val();


        this.show_page(pages.PROCESSING, "Setting password...", "Please wait...", false);
        this.send(Message.encode({
            type: Message.Type.SET_PASSWORD,
            auth: {
                user: this.user_name,
                password: pwd,
                hash: this.hash
            },
            captcha: {
                key: captcha
            }
        }).finish())
    }
    
    function removeURLParameter(url, parameter) {
        var urlparts = url.split('?');   
        if (urlparts.length >= 2) {

            var prefix = encodeURIComponent(parameter) + '=';
            var pars = urlparts[1].split(/[&;]/g);

            for (var i = pars.length; i-- > 0;) {    
                if (pars[i].lastIndexOf(prefix, 0) !== -1) {  
                    pars.splice(i, 1);
                }
            }

            return urlparts[0] + (pars.length > 0 ? '?' + pars.join('&') : '');
        }
        return url;
    }
</script>