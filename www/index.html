<!DOCTYPE html>
<html>

<head>
    <title>MetaHumanity.xyz</title>
    <meta charset="utf-8" name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="icon" type="image/x-icon" href="assets/icon/favicon.ico">
    <link rel="stylesheet" href="codemirror/lib/codemirror.css">
    <link rel="stylesheet" href="codemirror/addon/dialog/dialog.css">
    <link rel="stylesheet" href="codemirror/addon/search/matchesonscrollbar.css">
    <link rel="stylesheet" href="codemirror/theme/the-matrix.css">

    <script type="text/javascript" src="codemirror/lib/codemirror.js"></script>
    <script type="text/javascript" src="codemirror/mode/javascript/javascript.js"></script>
    <script type="text/javascript" src="codemirror/mode/clike/clike.js"></script>
    <script type="text/javascript" src="codemirror/mode/xml/xml.js"></script>

    <script type="text/javascript" src="codemirror/addon/display/autorefresh.js"></script>
    <script type="text/javascript" src="codemirror/addon/dialog/dialog.js"></script>
    <script type="text/javascript" src="codemirror/addon/search/searchcursor.js"></script>
    <script type="text/javascript" src="codemirror/addon/search/search.js"></script>
    <script type="text/javascript" src="codemirror/addon/scroll/annotatescrollbar.js"></script>
    <script type="text/javascript" src="codemirror/addon/search/matchesonscrollbar.js"></script>
    <script type="text/javascript" src="codemirror/addon/search/jump-to-line.js"></script>

    <!-- <script type="text/javascript" src="js/r.js"></script> -->
    <script type="text/javascript" src="js/jquery.min.js"></script>

    <link rel="stylesheet" href="css/bootstrap.min.css" />
    <link rel="stylesheet" href="css/style.css" />

    <script lang="javascript" type="text/javascript" src="id3/binaryajax.js"></script>
    <script lang="javascript" type="text/javascript" src="id3/bufferedbinaryajax.js"></script>
    <script lang="javascript" type="text/javascript" src="id3/id3.js"></script>
    <script lang="javascript" type="text/javascript" src="id3/id3v1.js"></script>
    <script lang="javascript" type="text/javascript" src="id3/id3v2.js"></script>
    <script lang="javascript" type="text/javascript" src="id3/id3v2frames.js"></script>
    <script lang="javascript" type="text/javascript" src="id3/id4.js"></script>
    <script lang="javascript" type="text/javascript" src="id3/stringutils.js"></script>
    <script lang="javascript" type="text/javascript" src="id3/base64.js"></script>


    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script type="text/javascript" src="js/bootstrap.bundle.min.js"></script>
    <script type="text/javascript" src="js/protobuf.js"></script>

</head>

<body>
    <div class="row connected_content"
        style="display: none; margin: 0px !important; z-index: 225; position:absolute; text-align:center; border:none !important; height:100%; width:100%;  overflow-y: auto; background-color: rgba(0.0, 0.0, 0.0, 0.0);"
        id="policy">
        <div class="col-xs-0 col-sm-1 col-md-2 col-lg-3">
        </div>
        <div class="col-xs-12 col-sm-10 col-md-8 col-lg-6">
            <br>
            <h1
                style="text-align:left; padding:5%; color:#fff; font-size: 18px !important; width:auto; background-color: rgba(0,0,0,.75); border-radius: 12px; border: 1px solid #fff !important;">
                Privacy Policy:
                <br>
                <br>
                1. Collected Information
                <br>
                <br>
                We collect information such your name, email, and password.
                <br>
                <br>
                We will not issue out your email or password to any third party.
                <br>
                <br>
                We may however use your email to contact you with regards to anything we deem fit. We may also publicly
                display your name.
                <br>
                <br>
                We also collect data related to the algorithms you create, edit, and fork on our site.
                <br>
                <br>
                For each algorithm (and associated data) you create/edit/fork, we may display this algorithm (or
                it's associated data) to any third party.
                <br>
                <br>
                2. Cookie Policy
                <br>
                <br>
                Our website does not use cookies to track any of your online events (which is why you have to log in
                every time you move to a new window).
                <br>
                <br>
                <br>
                <div style="text-align: center;">
                    <button type="button" class="btn btn-outline-success mx-auto" onclick="state.back();">Ok</button>
                </div>
            </h1>
        </div>
        <div class="col-xs-0 col-sm-1 col-md-2 col-lg-3">
        </div>
    </div>

    <div class="row connected_content"
        style="display: none; margin: 0px !important; z-index: 230; position:absolute; text-align:center; border:none !important; height:100%; width:100%;  overflow-y: auto; background-color: rgba(0., 0., 0., 0.);"
        id="logout">
        <div class="col-xs-0 col-sm-1 col-md-2 col-lg-3">
        </div>
        <div class="col-xs-12 col-sm-10 col-md-8 col-lg-6">
            <div style="height: 10%;"></div>
            <h1 style=" padding:5%; text-align:center; color:#f00; font-size: 24px !important; width:auto; background-color: rgba(0,0,0,.75); border-radius: 12px; border: 1px solid #fff !important;"
                class="blink-white">
                <div style="text-align:center; color:#f00; font-size: 24px !important;" class="blink-white">
                    This action will log you off by resetting the connection to the server!
                </div>
                <br>
                <label style="font-size: 18px !important;color: #fff;">
                    Click OK to continue, and cancel to return.
                </label>
                <br>
                <br>
                <div style="text-align: center;">
                    <button type="button" class="btn btn-outline-success mx-auto"
                        onclick="state.back();">Cancel</button>
                    <button type="button" class="btn btn-outline-danger mx-auto" onclick="state.logout()">OK</button>
                </div>
            </h1>
        </div>
        <div class="col-xs-0 col-sm-1 col-md-2 col-lg-3">
        </div>
    </div>
    <div class="row connected_content"
        style="display: none; margin: 0px !important; z-index: 230; position:absolute; text-align:center; border:none !important; height:100%; width:100%;  overflow-y: auto; background-color: rgba(0., 0., 0., 0.);"
        id="delete_algorithm">
        <div class="col-xs-0 col-sm-1 col-md-2 col-lg-3">
        </div>
        <div class="col-xs-12 col-sm-10 col-md-8 col-lg-6">
            <div style="height: 10%;"></div>
            <h1 style=" padding:5%; text-align:center; color:#f00; font-size: 24px !important; width:auto; background-color: rgba(0,0,0,.75); border-radius: 12px; border: 1px solid #fff !important;"
                class="blink-white">
                <div style="text-align:center; color:#f00; font-size: 24px !important;" class="blink-white">
                    This action is permanent and irreversable. Are you sure you want to delete this algorithm?
                </div>
                <br>
                <label style="font-size: 18px !important;color: #fff;">
                    Click OK to continue, and cancel to return.
                </label>
                <br>
                <br>
                <div style="text-align: center;">
                    <button type="button" class="btn btn-outline-success mx-auto"
                        onclick="state.back();">Cancel</button>
                    <button type="button" class="btn btn-outline-danger mx-auto"
                        onclick="state.end_algorithm_delete();">Delete Video</button>
                </div>
            </h1>
        </div>
        <div class="col-xs-0 col-sm-1 col-md-2 col-lg-3">
        </div>
    </div>
    <div class="row connected_content"
        style="display: none; margin: 0px !important; z-index: 200; position:absolute; text-align:center; border:none !important; height:100%; width:100%;  overflow-y: auto; background-color: rgba(.666,.666,.666,0.0);"
        id="request">
        <div class="col-xs-0 col-sm-1 col-md-2 col-lg-3">
        </div>
        <div class="col-xs-12 col-sm-10 col-md-8 col-lg-6">
            <br>
            <h1 style="text-align:center; color:#0f0; font-size: 18px !important; width:auto; background-color: rgba(0,0,0,.75); border-radius: 12px; border: 1px solid #fff !important;"
                class="blink-white">
                <br>
                Request a password reset link for your account below:
                <br>
                <br>
            </h1>

            <h1
                style="text-align:center; color:#fff; font-size: 18px !important; width:auto; background-color: rgba(0,0,0,.75); border-radius: 12px; border: 1px solid #fff !important;">
                <br>
                By requesting a reset link for your password you agree to our privacy policy:
                <br>
                <br>

                <div style="text-align: center;">
                    <button type="button" class="btn btn-outline-primary mx-auto"
                        onclick="state.show_page(pages.POLICY);">View
                        Privacy Policy</button>
                </div>
                <br>




                <div
                    style="display: inline-block; text-align:center; color:#fff; font-size: 18px !important; width:50%;">
                    Name or Email
                </div>
                <input type="text" style="display: inline-block; font-size: 18px !important; width:40%;"
                    class="form-control" id="request_password_reset" placeholder="Name or Email">


                <br>
                <br>

                <div style="display: inline-block; width:50%">
                    <img style="display: inline-block; text-align:center; color:#fff; font-size: 18px !important; height:50%;"
                        id="request_captcha">
                </div>
                <input type="text" style="display: inline-block; font-size: 18px !important; width:40%;"
                    class="form-control" id="request_captcha_input" placeholder="Captcha">
                <br>
                <br>


                <div style="text-align: center;">
                    <button type="button" class="btn btn-outline-success mx-auto" onclick="state.send_request()">Send
                        Email</button>
                    <button type="button" class="btn btn-outline-warning mx-auto"
                        onclick="state.back();">Cancel</button>
                </div>
                <br>
            </h1>
        </div>
        <div class="col-xs-0 col-sm-1 col-md-2 col-lg-3">
        </div>
    </div>

    <div class="row connected_content"
        style="display: none; margin: 0px !important; z-index: 20; position:absolute; text-align:center; border:none !important; height:100%; width:100%;  overflow-y: auto; background-color: rgba(0,0,0,.75);"
        id="reset">
        <div style="height: 7.5%;"></div>
        <div class="col-xs-0 col-sm-1 col-md-2 col-lg-3">
        </div>
        <div class="col-xs-12 col-sm-10 col-md-8 col-lg-6">
            <br>
            <h1 style="text-align:center; color:#0f0; font-size: 18px !important; width:auto; background-color: rgba(0,0,0,.75); border-radius: 12px; border: 1px solid #fff !important;"
                class="blink-white">
                <br>
                Create or change the password for your account below:
                <br>
                <br>
            </h1>

            <h1
                style="text-align:center; color:#fff; font-size: 18px !important; width:auto; background-color: rgba(0,0,0,.75); border-radius: 12px; border: 1px solid #fff !important;">
                <br>
                By (re)setting your password you agree to our privacy policy:
                <br>
                <br>

                <div style="text-align: center;">
                    <button type="button" class="btn btn-outline-primary mx-auto"
                        onclick="state.show_page(pages.POLICY);">View
                        Privacy Policy</button>
                </div>
                <br>

                A valid password has at least one number, at least one letter, and at least six characters.
                <br>
                <br>
                <div
                    style="display: inline-block; text-align:center; color:#fff; font-size: 18px !important; width:50%;">
                    Password
                </div>
                <input type="password" style="display: inline-block; font-size: 18px !important; width:40%;"
                    class="form-control" id="reset_password" placeholder="Password">
                <br>
                <br>
                <div
                    style="display: inline-block; text-align:center; color:#fff; font-size: 18px !important; width:50%;">
                    Re-type Password
                </div>
                <input type="password" style="display: inline-block; font-size: 18px !important; width:40%;"
                    class="form-control" id="reset_retype" placeholder="Password">
                <br>
                <br>
                <div style="display: inline-block; text-align:center; min-width:50%; max-height:50% !important;">
                    <img style="display: inline-block; text-align:center; color:#fff; font-size: 18px !important; max-width:50%;"
                        id="reset_captcha">
                </div>
                <input type="text" style="display: inline-block; font-size: 18px !important; width:40%;"
                    class="form-control" id="reset_captcha_input" placeholder="Captcha">
                <br>
                <br>

                <button type="button" class="btn btn-outline-success mx-auto" onclick="state.set_password()">Set
                    Password</button>
                <br>
                <br>
            </h1>
            </table>

        </div>
        <div class="col-xs-0 col-sm-1 col-md-2 col-lg-3">
        </div>
    </div>

    <div class="row disconnected_content"
        style="display: none; margin: 0px !important; z-index: 250; position:fixed; text-align:center; border:none !important; height:100%; width:100%;  overflow-y: auto; background-color: rgba(0., 0., 0., 0.);"
        id="processing">
        <div class="col-xs-0 col-sm-1 col-md-2 col-lg-3">
        </div>
        <div class="col-xs-12 col-sm-10 col-md-8 col-lg-6">
            <div style="height: 20%;"></div>
            <h1 style=" padding:5%; text-align:center; color:#f00; font-size: 24px !important; width:auto; background-color: rgba(0,0,0,.75); border-radius: 12px; border: 1px solid #fff !important;"
                class="blink-white">
                <div id="processing_header" style="text-align:center; color:#0f0; font-size: 24px !important;"
                    class="blink-white">
                    Infinite processing.
                </div>
                <br>
                <label id="processing_message" style="font-size: 18px !important;color: #fff;">
                    Don't hold you're breath.
                </label>
                <br>
                <br>
                <div style="text-align: center;">
                    <button type="button" class="opt_out btn btn-outline-success mx-auto" style="display: none;"
                        onclick="state.back()">OK</button>
                </div>
            </h1>
        </div>
        <div class="col-xs-0 col-sm-1 col-md-2 col-lg-3">
        </div>
    </div>
    <div class="row disconnected_content"
        style="display: none; margin: 0px !important; z-index: 225; position:absolute; text-align:center; border:none !important; height:100%; width:100%;  overflow-y: auto; background-color: rgba(0., 0., 0., 0.);"
        id="reconnect">
        <div class="col-xs-0 col-sm-1 col-md-2 col-lg-3">
        </div>
        <div class="col-xs-12 col-sm-10 col-md-8 col-lg-6">
            <div style="height: 20%;"></div>
            <h1 style=" padding:5%; text-align:center; color:#f00; font-size: 24px !important; width:auto; background-color: rgba(0,0,0,.75); border-radius: 12px; border: 1px solid #fff !important;"
                class="blink-white">
                <div style="text-align:center; color:#f00; font-size: 24px !important;" class="blink-white">
                    There is no connection to the server.
                </div>
                <br>
                <label style="font-size: 18px !important;color: #fff;">
                    Click "Reconnect" to reconnect.
                </label>
                <br>
                <br>
                <div style="text-align: center;">
                    <button type="button" class="btn btn-outline-success mx-auto"
                        onclick="state.reconnect()">Reconnect</button>
                </div>
            </h1>
        </div>
        <div class="col-xs-0 col-sm-1 col-md-2 col-lg-3">
        </div>
    </div>
    <div class="row disconnected_content"
        style="display: none; margin: 0px !important; z-index: 300; position:absolute; text-align:center; border:none !important; height:100%; width:100%;  overflow-y: auto; background-color: rgba(0., 0., 0., 0.);"
        id="client_error">
        <div class="col-xs-0 col-sm-1 col-md-2 col-lg-3">
        </div>
        <div class="col-xs-12 col-sm-10 col-md-8 col-lg-6">
            <div style="height: 20%;"></div>
            <h1 style=" padding:5%; text-align:center; color:#f00; font-size: 24px !important; width:auto; background-color: rgba(0,0,0,.75); border-radius: 12px; border: 1px solid #fff !important;"
                id="error_bubble" class="blink-white">
                <div id="client_error_header" style="text-align:center; color:#f00; font-size: 24px !important;"
                    class="blink-white">
                </div>
                <br>
                <label id="client_error_message" style="font-size: 18px !important;color: #fff;"></label>
                <br>
                <br>
                <div style="text-align: center;">
                    <button type="button" class="opt_out btn btn-outline-danger mx-auto"
                        onclick="state.back();">OK</button>
                </div>
            </h1>

        </div>
        <div class="col-xs-0 col-sm-1 col-md-2 col-lg-3">
        </div>
    </div>
    <div class="row disconnected_content"
        style="display: none; margin: 0px !important; z-index: 400; position:absolute; text-align:center; border:none !important; height:100%; width:100%;  overflow-y: auto; background-color: rgba(0., 0., 0., 0.);"
        id="server_error">
        <div class="col-xs-0 col-sm-1 col-md-2 col-lg-3">
        </div>
        <div class="col-xs-12 col-sm-10 col-md-8 col-lg-6">
            <div style="height: 20%;"></div>
            <h1 style=" padding:5%; text-align:center; color:#f00; font-size: 24px !important; width:auto; background-color: rgba(0,0,0,.75); border-radius: 12px; border: 1px solid #fff !important;"
                id="error_bubble" class="blink-white">
                <div id="server_error_header" style="text-align:center; color:#f00; font-size: 24px !important;"
                    class="blink-white">
                </div>
                <br>
                <label id="server_error_message" style="font-size: 18px !important;color: #fff;"></label>
                <br>
                <br>
                <div style="text-align: center;">
                    <button type="button" class="opt_out    btn btn-outline-danger mx-auto"
                        onclick="state.back();">OK</button>
                </div>
            </h1>

        </div>
        <div class="col-xs-0 col-sm-1 col-md-2 col-lg-3">
        </div>
    </div>
    <div class="row connected_content fixed"
        style="display: none; position: relative;; z-index:5; left:0px; top:0px; width:100%; height:auto;" id="menu">
        <div class="col-xs-0 col-sm-0 col-md-0 col-lg-0">
        </div>
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
            <br>
            <div style="text-align: center;">
                <button type="button" style=" background-color: rgba(.25,.25,.25,.75);"
                    class="btn btn-outline-success mx-auto" onclick="state.show_page(pages.HOME); ">Home</button>
                <button type="button" style=" background-color: rgba(.25,.25,.25,.75);"
                    class="btn btn-outline-success mx-auto" onclick="state.show_page(pages.BROWSE); ">Browse</button>
                <button type="button" style=" background-color: rgba(.25,.25,.25,.75);"
                    class="btn btn-outline-success mx-auto" onclick="state.show_page(pages.EDIT); ">Edit</button>
                <button type="button" style=" background-color: rgba(.25,.25,.25,.75);"
                    class="btn btn-outline-success mx-auto" onclick="state.show_page(pages.CREATE); ">Create</button>
                <button id="menu_profile_button" style=" background-color: rgba(.25,.25,.25,.75);" type="button"
                    class="logged_in_content btn btn-outline-primary mx-auto"
                    onclick="state.show_page(pages.PROFILE);;">Profile</button>
                <button id="menu_login_button" style=" background-color: rgba(.25,.25,.25,.75);" type="button"
                    class="logged_out_content btn btn-outline-success mx-auto"
                    onclick="state.show_page(pages.LOGIN);">Login</button>
                <button id="menu_signup_button" style=" background-color: rgba(.25,.25,.25,.75);" type="button"
                    class="logged_out_content btn btn-outline-primary mx-auto"
                    onclick="state.show_page(pages.SIGNUP);">Sign
                    Up</button>
                <button id="menu_logout_button" style=" background-color: rgba(.25,.25,.25,.75);" type="button"
                    class="logged_in_content btn btn-outline-danger mx-auto"
                    onclick="state.show_page(pages.LOGOUT);">Log
                    Out</button>
            </div>`
        </div>
        <div class="col-xs-0 col-sm-0 col-md-0 col-lg-0">
        </div>
    </div>

    <div style="display:block; position:relative; left:0px; top:0px; width:100%; height:100%;">
        <div class="row connected_content" id="home"
            style="display: none; position:absolute; left:0px; top:0px; width:100%; height:100%;">
            <div class="col-xs-0 col-sm-1 col-md-2 col-lg-3">
            </div>
            <div class="col-xs-12 col-sm-10 col-md-8 col-lg-6">
                <h1
                    style="padding: 18px; text-align:center; color:#fff; font-size: 18px !important; width:auto; background-color: rgba(0,0,0,.75); border-radius: 12px; border: 1px solid #fff !important;">
                    Welcome!
                    <br>
                </h1>
                <br>
                <h1 class="logged_out_content"
                    style="padding: 18px; text-align:left; color:#fff; font-size: 18px !important; width:auto; background-color: rgba(0,0,0,.75); border-radius: 12px; border: 1px solid #fff !important;">
                    For more information, use one of the three option buttons below:
                    <br>
                    <br>

                    <div style="text-align: center;">
                        <button type="button" class="btn btn-outline-success mx-auto"
                            onclick="state.show_page(pages.LOGIN);">Login</button>
                        <button type="button" class="btn btn-outline-primary mx-auto"
                            onclick="state.show_page(pages.SIGNUP);">Sign
                            Up</button>
                        <button type="button" class="btn btn-outline-primary mx-auto"
                            onclick="state.show_page(pages.POLICY);">View
                            Privacy Policy</button>
                    </div>
                </h1>
                <h1 class="logged_in_content"
                    style="padding: 18px; text-align:left; color:#fff; font-size: 18px !important; width:auto; background-color: rgba(0,0,0,.75); border-radius: 12px; border: 1px solid #fff !important;">
                    You have successfully logged in! To continue, use one of the options below:
                    <br>
                    <br>

                    <div style="text-align: center;">
                        <button type="button" class="btn btn-outline-primary mx-auto"
                            onclick="state.show_page(pages.POLICY);">View
                            Privacy Policy</button>
                        <button type="button" style=" background-color: rgba(.25,.25,.25,.75);"
                            class="btn btn-outline-success mx-auto"
                            onclick="state.show_page(pages.BROWSE); ">Browse</button>
                        <button type="button" style=" background-color: rgba(.25,.25,.25,.75);"
                            class="btn btn-outline-success mx-auto"
                            onclick="state.show_page(pages.EDIT); ">Edit</button>
                        <button type="button" style=" background-color: rgba(.25,.25,.25,.75);"
                            class="btn btn-outline-success mx-auto"
                            onclick="state.show_page(pages.CREATE); ">Create</button>
                        <button type="button" class="btn btn-outline-primary mx-auto"
                            onclick="state.show_page(pages.PROFILE);">Profile</button>
                        <button type="button" class="btn btn-outline-danger mx-auto"
                            onclick="state.show_page(pages.LOGOUT);">Log
                            Out</button>
                    </div>
                </h1>
            </div>
            <div class="col-xs-0 col-sm-1 col-md-2 col-lg-3">
            </div>
        </div>
    </div>

    <div class="row connected_content" id="edit">
        <div class="col-xs-0 col-sm-1 col-md-2 col-lg-3">
        </div>
        <div onclick="profileClicked(algorithm.owner)" class="col-xs-12 col-sm-10 col-md-8 col-lg-6 instruction"
            style="color:#fff!important;">
            <img src="{{((algorithm.thumbnail && algorithm.thumbnail.url) ? algorithm.thumbnail.url : defaultImage)}}"
                style="height:100% !important; max-height:128px !important; width:auto!important; clear: right !important; float: left !important; border: 2px solid #0f0 !important;" />

            <a style="color:#0F0!important; display:inline;">Title</a>
            <p style="display:inline;">&nbsp;{{algorithm.name}}</p>
            <br>
            <a style="color:#0F0!important; display:inline;">Author</a>
            <p style="display:inline;">&nbsp;{{algorithm.owner.name}}</p>
            <br>
            <a style="color:#0F0!important; display:inline;">Created</a>
            <p style="display:inline;">&nbsp;{{getCreated()}}</p>
            <br>
            <a style="color:#0F0!important; display:inline;">Edited</a>
            <p style="display:inline;">&nbsp;{{getEdited()}}</p>
            <br>
            <a style="color:#0F0!important; display:inline;">Views</a>
            <p style="display:inline;">&nbsp;{{algorithm.views}}</p>
            <br>
            <a style="color:#0F0!important; display:inline;">Votes</a>
            <p style="display:inline;">&nbsp;{{voteTally()}}</p>
            <br>
            <!--a style="color:#0F0!important; display:inline;">Comments</a>
                            <p style="display:inline;">&nbsp;{{algorithm.comments.length}}</p-->
            <br>
            <a style="color:#0F0!important; display:inline;">Description</a>
            <p style="display:inline;">&nbsp;{{algorithm.description}}</p>
            <div style="padding-left: 15%; padding-right: 15%; width:100%; height:auto; text-align: center;"
                *ngIf="isUsable()">

                <div style="text-align: center;">
                    <h1 class="banner center-please" style="display:inline-block;">Algorithm Title</h1>
                </div>
                <input style="color:#fff; width: 100%;" placeholder="Algorithm name..."
                    [(ngModel)]="algorithm.name"></input>
            </div>
            <div style="padding-left: 15%; padding-right: 15%; width:100%; height:auto; text-align: center;"
                *ngIf="isUsable()">

                <div style="text-align: center;">
                    <h1 class="banner center-please" style="display:inline-block;">Algorithm Description</h1>
                </div>
                <textarea id="comment" rows="8" placeholder="Enter description here..."
                    [(ngModel)]="algorithm.description"></textarea>
            </div>
            <div style="text-align: center;">
                <h1 class="banner center-please" style="display:inline-block;">Settings</h1>
            </div>
            <br>
            <list class="" style="background-color: rgba(0, 0, 0, 0.0) !important;">
                <div style="border-top:3px solid #0f0;">
                    <div class="checkbox">
                        <input style="float:right;" id="public_checkbox" type="checkbox" [(ngModel)]="algorithm.public"
                            value="">
                        <label for="public_checkbox">&nbsp;&nbsp;&nbsp;Public</label>
                    </div>
                </div>
                <div style="border-top:3px solid #0f0;">
                    <div class="checkbox">
                        <input style="float:right;" id="html_checkboxk" type="checkbox"
                            [(ngModel)]="algorithm.state.has_html" value="">
                        <label for="html_checkboxk">&nbsp;&nbsp;&nbsp;HTML</label>
                    </div>
                </div>
                <div class="instruction" *ngIf="isUsable() && algorithm.state.has_html"
                    style="border-top:3px solid #0f0;">
                    <xml-editor [(value)]="algorithm.html">
                        <textarea #textarea rows="32" placeholder="Enter glsl code here..."
                            [(ngModel)]="value"></textarea>
                    </xml-editor>
                </div>
                <div style="border-top:3px solid #0f0;">
                    <div class="checkbox">
                        <input style="float:right;" id="client_checkbox" type="checkbox"
                            [(ngModel)]="algorithm.state.has_client" value="">
                        <label for="client_checkbox">&nbsp;&nbsp;&nbsp;javascript</label>
                    </div>
                </div>
                <div class="instruction" *ngIf="isUsable() && algorithm.state.has_client"
                    style="border-top:3px solid #0f0;">
                    <javascript-editor [(value)]="algorithm.client">

                        <textarea #textarea rows="32" placeholder="Enter javascript code here..."
                            [(ngModel)]="value"></textarea>
                    </javascript-editor>
                </div>

                <list style="border-top:3px solid #0f0;">
                    <item>
                        <label>Audio Files</label>
                    </item>

                    <audio-list>

                        <list [ngClass]="customClass.name" *ngIf="algorithm.sounds != null">
                            <item *ngFor="let song of algorithm.sounds; let i = index;">
                                <div style="text-align: center;">
                                    <div class="instruction" style="word-wrap: break-word;">
                                        <div style="text-align: center !important;">
                                            <u style="text-align: center!important;">Track #{{i}}</u>
                                        </div>
                                        <br>
                                        <div>
                                            <a style="color:#0f0;">Artist:</a>&nbsp;<b
                                                style="word-wrap: break-word !important;">{{song.artist}}</b><br>
                                            <a style="color:#0f0;">Title:</a>&nbsp;<b
                                                style="word-wrap: break-word !important;">{{song.title}}</b><br>
                                            <a style="color:#0f0;">Album:</a>&nbsp;<b
                                                style="word-wrap: break-word !important;">{{song.album}}</b><br>
                                        </div>
                                        <br>
                                        <audio-item [index]="i" style="text-align: center;" id="audio-player{{i}}">

                                            <div>
                                                <audio class="audio-player" type="audio/mp3" crossorigin="anonymous"
                                                    controls="controls"></audio>
                                            </div><!-- @end .audio-player -->

                                            <br>
                                            <div style="text-align: center !important">
                                                <a class="custom-btn btn btn-lg btn-primary" onclick="removeTrack()"
                                                    style="text-align: center;   font-size:.75em; border-color:#f00 !important; color:#fff;"
                                                    role="button">Delete Song</a>
                                            </div>
                                        </audio-item>
                                    </div>
                                </div>
                            </item>
                        </list>

                    </audio-list>

                    <item style="text-align: center !important;">

                        <audio-upload>

                            <input (change)="audioUpload()" style="display:none;" id="audioInput" type="file"
                                name="sound" accept="audio/*">
                            <a *ngIf="maxAudio()" onclick="change()" class="custom-btn btn btn-lg btn-primary"
                                id="falseAudioInput" role="button">Upload Audio File</a>

                        </audio-upload>
                    </item>



                    <context-list>

                        <div id="contextCarousel" class="carousel context-carousel slide" style="text-align:center"
                            data-interval="false">

                            <br>
                            <item style="border-top:3px solid #0f0;">
                                <label>WebGL Contexts</label>
                            </item>

                            <a onclick="addContextChange()" class="custom-btn btn btn-lg btn-primary"
                                id="addContextButton" role="button">Add OpenGL Context</a>
                            <div>
                                <br>
                                <div *ngFor="let context of algorithm.pipeline.contexts; let i = index;"
                                    style="display: inline-block">
                                    &nbsp;
                                    <a role="button"
                                        [ngClass]="'custom-btn btn btn-lg btn-primary '+((i == currentContextViewed) ? 'yellow-highlight-class' : '')"
                                        data-target="#contextCarousel" onclick="viewContext(i)"
                                        [attr.data-slide-to]="i">
                                        Context #{{i}}
                                    </a>
                                    &nbsp;
                                </div>
                            </div>
                            <br>
                            <div class="carousel-inner" role="listbox"
                                *ngFor="let context of algorithm.pipeline.contexts; let i = index;">
                                <context-item [ngClass]="'item '+((i == currentContextViewed) ? 'active' : '')"
                                    style="text-align: center;" [index]="i" id="context-item{{i}}">

                                    <div class="instruction">
                                        <div style="text-align: center !important;">

                                            <div style="text-align: center !important">
                                                <a class="custom-btn btn btn-lg btn-primary" (change)="refresh()"
                                                    onclick="removeContext()"
                                                    style="text-align: center;   font-size:.75em; border-color:#f00 !important; color:#fff;"
                                                    role="button">Delete Context</a>
                                            </div>
                                            <br>

                                            <div *ngIf="context != null">
                                                <item style="border-bottom: none; box-shadow: none;">
                                                    <label>Context Name</label>
                                                    <input style="color:#fff; width: 100%;"
                                                        placeholder="Context name..."
                                                        [(ngModel)]="context.name"></input>
                                                </item>
                                            </div>
                                            <br>

                                            <div style="text-align: left !important">
                                                <div class="checkbox">
                                                    <input style="float:right;" id="depth_checkbox" type="checkbox"
                                                        [(ngModel)]="context.depth_test" value="">
                                                    <label
                                                        for="depth_checkbox">&nbsp;&nbsp;&nbsp;Depth/Component</label>
                                                </div>
                                            </div>


                                            <br>
                                            <div class="instruction">
                                                <image-list [context]="index">
                                                    <list [ngClass]="customClass.name">

                                                        <item>
                                                            <label>Image Files</label>
                                                        </item>
                                                        <div
                                                            *ngIf="algorithm != null && algorithm.pipeline.contexts != null && algorithm.pipeline.contexts[context].images != null">
                                                            <item
                                                                *ngFor="let image of algorithm.pipeline.contexts[context].images; let i = index;">
                                                                <div style="text-align: center;">
                                                                    <div class="instruction"
                                                                        style="word-wrap: break-word;">
                                                                        <div style="text-align: center !important;">
                                                                            <u style="text-align: center!important;">Image
                                                                                #{{i}}</u>
                                                                        </div>
                                                                        <br>
                                                                        <a style="color:#0f0;">Owner:</a>&nbsp;
                                                                        <b
                                                                            style="word-wrap: break-word !important;">{{image.owner.name}}</b>
                                                                        <br>
                                                                        <a style="color:#0f0;">Title:</a>&nbsp;
                                                                        <b
                                                                            style="word-wrap: break-word !important;">{{image.title}}</b>
                                                                        <br>

                                                                        <image-canvas style="text-align: center;"
                                                                            [context]="context" [index]="i"
                                                                            id="image-canvas-context{{context}}-index{{i}}">

                                                                            <div>
                                                                                <canvas style="max-width:75%;"></canvas>
                                                                            </div>
                                                                            <br>
                                                                            <div style="text-align: center !important">
                                                                                <a class="custom-btn btn btn-lg btn-primary"
                                                                                    (change)="refresh()"
                                                                                    onclick="removeImage()"
                                                                                    style="text-align: center;   font-size:.75em; border-color:#f00 !important; color:#fff;"
                                                                                    role="button">Delete
                                                                                    Image</a>
                                                                            </div>
                                                                        </image-canvas>
                                                                    </div>
                                                                </div>
                                                            </item>
                                                        </div>
                                                    </list>
                                                </image-list>
                                                <item style="text-align: center !important;">

                                                    <image-upload [context]="index">

                                                        <input (change)="imageUpload()" style="display:none;"
                                                            id="imageInputContext{{context}}" type="file" name="image"
                                                            accept="image/*">
                                                        <a *ngIf="maxImages()" onclick="change()"
                                                            class="custom-btn btn btn-lg btn-primary"
                                                            id="falseImageInput" role="button">Upload
                                                            Image
                                                            File</a>

                                                    </image-upload>
                                                </item>
                                            </div>
                                            <br>
                                            <div
                                                *ngIf="context != null && context.width != null && context.height != null">
                                                <label>Context Width</label>
                                                <br>
                                                <opengl-dimension [(value)]="context.width">
                                                    <div *ngIf="dimensionType != null">
                                                        <item>
                                                            <label>Dimension Type</label>
                                                            <select [(ngModel)]="dimensionType"
                                                                (ionChange)="onDimensionChange()" okText="Select"
                                                                cancelText="Cancel"
                                                                [compareWith]="compareDimensionType">
                                                                <option *ngFor="let o of dimensionTypeData" [value]="o">
                                                                    {{o.text}}</option>
                                                            </select>
                                                        </item>
                                                        <javascript-editor style="text-align: left" *ngIf="isExact()"
                                                            [(value)]="dimension.exact_value">

                                                            <textarea #textarea rows="32"
                                                                placeholder="Enter javascript code here..."
                                                                [(ngModel)]="value"></textarea>
                                                        </javascript-editor>
                                                    </div>
                                                </opengl-dimension>
                                                <br>
                                                <label>Context Height</label>
                                                <br>
                                                <opengl-dimension [(value)]="context.height">
                                                    <div *ngIf="dimensionType != null">
                                                        <item>
                                                            <label>Dimension Type</label>
                                                            <select [(ngModel)]="dimensionType"
                                                                (ionChange)="onDimensionChange()" okText="Select"
                                                                cancelText="Cancel"
                                                                [compareWith]="compareDimensionType">
                                                                <option *ngFor="let o of dimensionTypeData" [value]="o">
                                                                    {{o.text}}</option>
                                                            </select>
                                                        </item>
                                                        <javascript-editor style="text-align: left" *ngIf="isExact()"
                                                            [(value)]="dimension.exact_value">

                                                            <textarea #textarea rows="32"
                                                                placeholder="Enter javascript code here..."
                                                                [(ngModel)]="value"></textarea>
                                                        </javascript-editor>
                                                    </div>
                                                </opengl-dimension>
                                            </div>
                                        </div>
                                        <br>
                                    </div>

                                </context-item>
                            </div>
                        </div>

                    </context-list>

                    <program-list>
                        <div id="programCarousel" class="carousel program-carousel slide" style="text-align:center"
                            data-interval="false">

                            <br>
                            <item style="border-top:3px solid #0f0;">
                                <label>WebGL Programs</label>
                            </item>

                            <a onclick="addProgramChange()" class="custom-btn btn btn-lg btn-primary"
                                id="addProgramButton" role="button">Add WebGL Program</a>
                            <div>
                                <br>
                                <div *ngFor="let program of algorithm.pipeline.programs; let i = index;"
                                    style="display: inline-block">
                                    &nbsp;
                                    <a role="button"
                                        [ngClass]="'custom-btn btn btn-lg btn-primary '+((i == currentProgramViewed) ? 'yellow-highlight-class' : '')"
                                        data-target="#programCarousel" onclick="viewProgram(i)"
                                        [attr.data-slide-to]="i">
                                        Program #{{i}}
                                    </a>
                                    &nbsp;
                                </div>
                            </div>
                            <br>
                            <div class="carousel-inner" role="listbox"
                                *ngFor="let program of algorithm.pipeline.programs; let i = index;">
                                <program-item [ngClass]="'item '+((i == currentProgramViewed) ? 'active' : '')"
                                    style="text-align: center;" [index]="i" id="program-item{{i}}">
                                    <div style="word-wrap: break-word;" class="instruction">
                                        <div style="text-align: center !important;">

                                            <br>
                                            <div style="text-align: center !important">
                                                <a class="custom-btn btn btn-lg btn-primary" (change)="refresh()"
                                                    onclick="removeProgram()"
                                                    style="text-align: center;   font-size:.75em; border-color:#f00 !important; color:#fff;"
                                                    role="button">Delete Program</a>
                                            </div>

                                            <br>
                                            <div *ngIf="program != null">
                                                <item style="border-bottom: none; box-shadow: none;">
                                                    <label>Program Name</label>
                                                    <input style="color:#fff; width: 100%;"
                                                        placeholder="Program name..."
                                                        [(ngModel)]="program.name"></input>
                                                </item>
                                            </div>
                                            <br>
                                            <div *ngIf="program != null">
                                                <uniform-list [index]="index">
                                                    <div id="uniformCarousel" class="carousel uniform-carousel slide"
                                                        style="text-align: center;" data-interval="false">

                                                        <item>
                                                            <label>Uniform Variables</label>
                                                        </item>

                                                        <a onclick="addUniformChange()"
                                                            class="custom-btn btn btn-lg btn-primary"
                                                            id="addUniformButton" role="button">Add
                                                            WebGL
                                                            Uniform to Program</a>
                                                        <div>
                                                            <br>
                                                            <div *ngIf="isUsable()">
                                                                <div *ngFor="let uniform of algorithm.pipeline.programs[index].uniforms; let i = index;"
                                                                    style="display: inline-block">
                                                                    &nbsp;
                                                                    <a role="button"
                                                                        [ngClass]="'custom-btn btn btn-lg btn-primary '+((i == currentUniformViewed) ? 'yellow-highlight-class' : '')"
                                                                        data-target="#uniformCarousel"
                                                                        onclick="viewUniform(i)"
                                                                        [attr.data-slide-to]="i">
                                                                        Uniform #{{i}}
                                                                    </a>
                                                                    &nbsp;
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <br>
                                                        <div *ngIf="isUsable()">
                                                            <div class="carousel-inner" role="listbox"
                                                                *ngFor="let uniform of algorithm.pipeline.programs[index].uniforms; let i = index;">
                                                                <uniform-item
                                                                    [ngClass]="'item '+((i == currentUniformViewed) ? 'active' : '')"
                                                                    style="text-align: center;" [index]="i"
                                                                    [program]="index" [uniform]="uniform"
                                                                    id="uniform-item{{i}}">
                                                                    <div style="text-align: center !important">
                                                                        <a class="custom-btn btn btn-lg btn-primary"
                                                                            onclick="removeUniform()"
                                                                            style="text-align: center;   font-size:.75em; border-color:#f00 !important; color:#fff;"
                                                                            role="button">Delete
                                                                            Uniform</a>
                                                                    </div>
                                                                    <item>

                                                                        <label>Uniform Type</label>
                                                                        <select [(ngModel)]="uniform.type"
                                                                            okText="Select" cancelText="Cancel"
                                                                            [compareWith]="compareUniformType">
                                                                            <option *ngFor="let o of uniformTypeData"
                                                                                [value]="o">{{o}}
                                                                            </option>
                                                                        </select>
                                                                    </item>
                                                                    <item>
                                                                        <label>Uniform Name</label>
                                                                        <input style="color:#fff; width: 100%;"
                                                                            placeholder="Uniform name..."
                                                                            [(ngModel)]="uniform.name"></input>
                                                                    </item>
                                                                    <item>
                                                                        <javascript-editor [(value)]="uniform.value">

                                                                            <textarea #textarea rows="32"
                                                                                placeholder="Enter javascript code here..."
                                                                                [(ngModel)]="value"></textarea>
                                                                        </javascript-editor>
                                                                    </item>
                                                                </uniform-item>
                                                            </div>
                                                        </div>
                                                    </div>




                                                </uniform-list>
                                            </div>
                                            <br>

                                            <div *ngIf="program != null">

                                                <br>
                                                <a onclick="code_editor='fragment'"
                                                    class="custom-btn btn btn-lg btn-primary" role="button">Fragment
                                                    Shader</a>&nbsp;
                                                <a onclick="code_editor='vertex'" *ngIf="program != null"
                                                    class="custom-btn btn btn-lg btn-primary" role="button">Vertex
                                                    Shader</a>&nbsp;
                                                <br>
                                                <br>
                                                <clike-editor style="text-align: left" *ngIf="code_editor=='fragment'"
                                                    [(value)]="program.frag_code">

                                                    <textarea #textarea rows="32" placeholder="Enter glsl code here..."
                                                        [(ngModel)]="value"></textarea>
                                                </clike-editor>
                                                <clike-editor style="text-align: left" *ngIf="code_editor=='vertex'"
                                                    [(value)]="program.vert_code">

                                                    <textarea #textarea rows="32" placeholder="Enter glsl code here..."
                                                        [(ngModel)]="value"></textarea>
                                                </clike-editor>
                                            </div>
                                        </div>
                                        <br>
                                    </div>
                                </program-item>
                            </div>

                            <!--a class="left carousel-control" href="#programCarousel" role="button" data-slide="prev">
                                                        <icon style="top:50%; color: #0f0; position: relative;" name="arrow-dropleft-circle"></icon>
                                                    </a>
                                                    <a class="right carousel-control" href="#programCarousel" role="button" data-slide="next">
                                                        <icon style="top:50%; color: #0f0; position: relative;" name="arrow-dropright-circle"></icon>
                                                    </a-->
                        </div>

                    </program-list>

                    <stage-list>
                        <div id="stageCarousel" class="carousel stage-carousel slide" style="text-align:center"
                            data-interval="false">

                            <br>
                            <item style="border-top:3px solid #0f0;">
                                <label>Pipeline Stages</label>
                            </item>

                            <a onclick="addStageChange()" class="custom-btn btn btn-lg btn-primary" id="addStageButton"
                                role="button">Add Pipeline Stage</a>
                            <div>
                                <br>
                                <div *ngFor="let stage of algorithm.pipeline.stages; let i = index;"
                                    style="display: inline-block">
                                    &nbsp;
                                    <a role="button"
                                        [ngClass]="'custom-btn btn btn-lg btn-primary '+((i == currentStageViewed) ? 'yellow-highlight-class' : '')"
                                        data-target="#stageCarousel" onclick="viewStage(i)" [attr.data-slide-to]="i">
                                        Stage #{{i}}
                                    </a>
                                    &nbsp;
                                </div>
                            </div>
                            <br>
                            <div class="carousel-inner" role="listbox"
                                *ngFor="let stage of algorithm.pipeline.stages; let i = index;">
                                <stage-item [ngClass]="'item '+((i == currentStageViewed) ? 'active' : '')"
                                    style="text-align: center;" [index]="i" id="stage-item{{i}}">
                                    <div style="word-wrap: break-word;" class="instruction">
                                        <div style="text-align: center !important;">
                                            <br>
                                            <div style="text-align: center !important">
                                                <a class="custom-btn btn btn-lg btn-primary" (change)="refresh()"
                                                    onclick="removeStage()"
                                                    style="text-align: center;   font-size:.75em; border-color:#f00 !important; color:#fff;"
                                                    role="button">Delete Stage</a>
                                            </div>

                                            <br>
                                            <div *ngIf="stage != null && stageType != null">
                                                <item>
                                                    <label>Stage Type</label>
                                                    <select [(ngModel)]="stageType" (ionChange)="onStageTypeChange()"
                                                        okText="Select" cancelText="Cancel"
                                                        [compareWith]="compareStageType">
                                                        <option *ngFor="let o of stageTypeData" [value]="o">
                                                            {{o.text}}</option>
                                                    </select>
                                                </item>
                                            </div>
                                            <br>
                                            <div *ngIf="stage != null">
                                                <item style="border-bottom: none; box-shadow: none;">
                                                    <label>Context Name</label>
                                                    <input style="color:#fff; width: 100%;"
                                                        placeholder="Context name..."
                                                        [(ngModel)]="stage.context_name"></input>
                                                </item>
                                            </div>
                                            <br>
                                            <div *ngIf="stage != null">
                                                <item style="border-bottom: none; box-shadow: none;">
                                                    <label>Program Name</label>
                                                    <input style="color:#fff; width: 100%;"
                                                        placeholder="Program name..."
                                                        [(ngModel)]="stage.program_name"></input>
                                                </item>
                                            </div>
                                            <br>

                                            <div *ngIf="stage != null">

                                                <br>
                                                <a onclick="code_editor='vertices'"
                                                    *ngIf="stage != null && stage.type!=Messages.OpenGLStage.Type.SHADER"
                                                    class="custom-btn btn btn-lg btn-primary" role="button">Vertices
                                                    JS</a>&nbsp;
                                                <a onclick="code_editor='indices'"
                                                    *ngIf="stage != null && stage.type!=Messages.OpenGLStage.Type.SHADER"
                                                    class="custom-btn btn btn-lg btn-primary" role="button">Indices
                                                    JS</a>
                                                <br>
                                                <br>
                                                <javascript-editor style="text-align: left"
                                                    *ngIf="code_editor=='vertices' && stage != null && stage.type!=Messages.OpenGLStage.Type.SHADER"
                                                    [(value)]="stage.mesh_vertices_eval">

                                                    <textarea #textarea rows="32"
                                                        placeholder="Enter javascript code here..."
                                                        [(ngModel)]="value"></textarea>
                                                </javascript-editor>
                                                <javascript-editor style="text-align: left"
                                                    *ngIf="code_editor=='indices' && stage != null && stage.type!=Messages.OpenGLStage.Type.SHADER"
                                                    [(value)]="stage.mesh_indices_eval">

                                                    <textarea #textarea rows="32"
                                                        placeholder="Enter javascript code here..."
                                                        [(ngModel)]="value"></textarea>
                                                </javascript-editor>
                                            </div>
                                        </div>
                                        <br>
                                    </div>
                                </stage-item>
                            </div>
                        </div>

                    </stage-list>

                </list>
            </list>
            <p style="text-align: center; padding: 0px;">
                <a class="custom-btn btn btn-lg btn-primary" onclick="compileAlgorithm()" role="button">Compile</a>
                <a class="custom-btn btn btn-lg btn-primary"
                    *ngIf="navigation.owned_content && navigation.current_page == navigation.edit_page || navigation.current_page == navigation.create_page"
                    onclick="saveAlgorithm()" role="button">Save</a>
                <a class="custom-btn btn btn-lg btn-primary"
                    *ngIf="navigation.current_page == navigation.edit_page && navigation.logged_in"
                    onclick="forkAlgorithm()" role="button">Fork</a>
                <a class="custom-btn btn btn-lg btn-primary"
                    *ngIf="navigation.public_content && navigation.current_page == navigation.edit_page"
                    onclick="openLive()" role="button">Live</a>
                <a class="custom-btn btn btn-lg btn-primary"
                    *ngIf="navigation.public_content && navigation.current_page == navigation.edit_page"
                    onclick="startDownload()" role="button">Download</a>
                <a class="custom-btn btn btn-lg btn-primary"
                    *ngIf="navigation.owned_content && navigation.current_page == navigation.edit_page"
                    onclick="deleteAlgorithm()" role="button">Delete</a>
            </p>
            <div class="row">
                <div style="width:100%; height:auto" class="container">
                    <div style="text-align: center;">
                        <h1 class="banner center-please" style="display:inline-block !important;">Comments</h1>
                    </div>
                </div>

                <div *ngIf="navigation.logged_in" style="padding-left: 15%; padding-right: 15%; width:100%; height:auto"
                    class="container">
                    <item>
                        <textarea id="comment" rows="8" placeholder="Enter comment here..."
                            [(ngModel)]="newComment"></textarea>
                    </item>
                    <br>
                    <p style="text-align: center; padding: 0px;">
                        <a class="custom-btn btn btn-lg btn-primary" *ngIf="!navigation.upvoted_content"
                            onclick="upVote()" role="button">Up Vote</a>
                        <a class="custom-btn btn btn-lg btn-primary" *ngIf="!navigation.downvoted_content"
                            onclick="downVote()" role="button">Down Vote</a>
                        <a class="custom-btn btn btn-lg btn-primary" onclick="postComment()" role="button">Post</a>
                    </p>
                </div>
            </div>
            <div class="row">
                <div style="padding-left: 15%; padding-right: 15%; width:100%; height:auto" class="container">
                    <list>
                        <item *ngFor="let unit of commentArray; let i = index;">
                            <card onclick="profileClicked(unit.owner)"
                                style="border: 2px solid #0f0; border-radius: 5px 5px 5px 5px;">
                                <img src="{{commentArray[i].owner.thumbnail.url}}"
                                    style="max-width:64px !important; clear: right !important; float: left !important; margin: 5px !important; border: none !important; width:100%!important;" />
                                <card-header style="color:#fff !important; padding: 0px !important;">
                                    <p>
                                        {{commentArray[i].owner.name}}
                                        <br>{{formatTime(commentArray[i].time)}}
                                    </p>
                                </card-header>

                                <card-content style="word-wrap: break-word !important; white-space: normal !important;">
                                    <p>
                                        {{commentArray[i].message}}
                                    </p>
                                </card-content>
                            </card>

                        </item>
                    </list>
                </div>
            </div>
            <div style="text-align: center;">
                <p style="display:inline-block;text-align: center !important;" class="instruction">
                    {{profile.name}}
                    <br>
                    <img src="{{profile.cover}}"
                        onerror="this.onerror=null;this.src='http://CrazedCoding.com/img/logo.png';"
                        style="height:100% !important; max-height:384px !important; max-width:100% !important; width:auto!important; border: 2px solid #0f0 !important;" />
                    <br>{{profile.views}} Views
                    <br>{{profile.votes}} Votes</p>
            </div>
            <div style="text-align: center; display:block;">
                <input id="searchBar" #searchBar class="search-area"
                    style="color:#fff; margin-right: 5px !important; width: 100%;  display:inline-block; width:40%;"
                    placeholder="Enter search criteria..." [(ngModel)]="searchInput"></input>&nbsp;
                <a class="search-area custom-btn btn btn-lg btn-primary" onclick="search()" role="button">Search</a>
            </div>
            <br>
            <p>
                <a [ngClass]="sortButtons[0]" class="custom-btn btn btn-lg btn-primary" onclick="sortViews()"
                    role="button">Views</a>
                <a [ngClass]="sortButtons[1]" class="custom-btn btn btn-lg btn-primary" onclick="sortVotes()"
                    role="button">Votes</a>
                <a [ngClass]="sortButtons[2]" class="custom-btn btn btn-lg btn-primary" onclick="sortCreated()"
                    role="button">Created</a>
                <a [ngClass]="sortButtons[3]" class="custom-btn btn btn-lg btn-primary" onclick="sortEdited()"
                    role="button">Edited</a></p>
            <p>
                <a class="custom-btn btn btn-lg btn-primary" style="border: 3px solid #f00 !important;"
                    onclick="clearSearch()" role="button">Clear Search / Clear Sort</a></p>
            <p>
                <a class="custom-btn btn btn-lg btn-primary" style="width:10%!important;" onclick="previousPage()"
                    role="button">&lt;</a>
                <a class="custom-btn btn btn-lg btn-primary" style="width:10%!important;" onclick="firstPage()"
                    role="button">&lt;&lt;</a>
                <a class="custom-btn btn btn-lg btn-primary" style="width:10%!important;" onclick="lastPage()"
                    role="button">&gt;&gt;</a>
                <a class="custom-btn btn btn-lg btn-primary" style="width:10%!important;" onclick="nextPage()"
                    role="button">&gt;</a></p>
            <p>
                <a class="custom-btn btn btn-lg btn-primary" onclick="copyCriteriea()" role="button">Page
                    {{paging.current_page+1}} of {{paging.max_page}}</a></p>
            <list>
                <item *ngFor="let unit of algorithmArray; let i = index;">
                    <card [ngClass]="algorithmArray[i].customClass" (mouseenter)="enter(unit.index)"
                        (mouseleave)="leave(unit.index)" onclick="click(unit.index)">
                        <img src="{{((algorithmArray[i].thumbnail && algorithmArray[i].thumbnail.url) ? algorithmArray[i].thumbnail.url : defaultImage)}}"
                            style="height:100% !important; max-height:128px !important; width:auto!important; clear: right !important; float: left !important; margin: 5px !important; border: 2px solid #0f0 !important;" />
                        <card-content style="word-wrap: normal !important; white-space: normal !important;">
                            <p style="min-width:33% !important; color:#FFF!important;">
                                <u><a style="color:#0F0!important;">Title</a></u>&nbsp;{{algorithmArray[i].name}}
                                <br>
                                <u><a style="color:#0F0!important;">Author</a></u>&nbsp;{{algorithmArray[i].owner.name}}
                                <br>
                                <u><a style="color:#0F0!important;">Created</a></u>&nbsp;{{getCreated(i)}}
                                <br>
                                <u><a style="color:#0F0!important;">Edited</a></u>&nbsp;{{getEdited(i)}}
                                <br>
                                <u><a style="color:#0F0!important;">Views</a></u>&nbsp;{{algorithmArray[i].views}}
                                <br>
                                <u><a style="color:#0F0!important;">Votes</a></u>&nbsp;{{getVotes(i)}}
                                <br>
                                <u><a style="color:#0F0!important;">Comments</a></u>&nbsp;{{getComments(i)}}
                                <br>
                                <u><a
                                        style="color:#0F0!important;">Description</a></u>&nbsp;{{algorithmArray[i].description}}
                            </p>
                        </card-content>
                    </card>
                </item>
            </list>
            <div style="text-align: center; display:block;">
                <p>
                    <a class="custom-btn btn btn-lg btn-primary" onclick="copyCriteriea()" role="button">Page
                        {{paging.current_page+1}} of {{paging.max_page}}</a></p>
                <p>
                    <a class="custom-btn btn btn-lg btn-primary" style="width:10%!important;" onclick="previousPage()"
                        role="button">&lt;</a>
                    <a class="custom-btn btn btn-lg btn-primary" style="width:10%!important;" onclick="firstPage()"
                        role="button">&lt;&lt;</a>
                    <a class="custom-btn btn btn-lg btn-primary" style="width:10%!important;" onclick="lastPage()"
                        role="button">&gt;&gt;</a>
                    <a class="custom-btn btn btn-lg btn-primary" style="width:10%!important;" onclick="nextPage()"
                        role="button">&gt;</a></p>
            </div>
        </div>
    </div>

    <div class="row connected_content" id="delete_account"
        style="display: none; position:absolute; left:0px; top:0px; width:100%; height:100%;">
        <div class="col-xs-0 col-sm-1 col-md-2 col-lg-3">
        </div>
        <div class="col-xs-12 col-sm-10 col-md-8 col-lg-6">
            <div style="height: 7.5%;"></div>

            <h1
                style="padding: 18px; text-align:left; color:#fff; font-size: 18px !important; width:auto; background-color: rgba(0,0,0,.75); border-radius: 12px; border: 1px solid #fff !important;">

                <div style="text-align:center; color:#f00; font-size: 24px !important;" class="blink-white">
                    This action is permanent and irreversable. Please make sure you actually intend to do
                    this!
                </div>
                <br>
                To delete your account: type the user name or email of this account, the captcha below, and
                then
                click "Delete Account". Click "Cancel" to abort account deletion.
                <br>
                <br>

                <table id="delete_table" style="background-color: transparent!important;" class="table table-dark">

                    <tbody>
                        <tr class="form-group" style="background-color: transparent!important;">
                            <th colspan="1" style="vertical-align: bottom;background-color: transparent!important;">
                                <h1
                                    style="background-color: transparent!important;display: inline-block;text-align:center;color:#fff;font-size: 18px !important;vertical-align: middle;">
                                    Name or Email
                                </h1>

                            </th>
                            <th colspan="2" style="background-color: transparent!important;">

                                <input type="text" style="" class="form-control" id="login_name_or_email_delete"
                                    placeholder="Name or Email">
                            </th>
                        </tr>
                        <tr class="form-group" style="background-color: transparent!important;">
                            <th colspan="1">
                                <img style="display: inline-block; text-align:center; color:#fff; font-size: 18px !important; max-width:100%;"
                                    id="delete_account_captcha">

                            </th>
                            <th colspan="1" style="vertical-align: middle;">
                                <input type="text" class="form-control" id="delete_account_captcha_input"
                                    placeholder="Captcha">
                            </th>
                        </tr>
                    </tbody>
                </table>
                <br>

                <div style="text-align: center;">
                    <button type="button" class="btn btn-outline-danger mx-auto"
                        onclick="state.delete_account();">Delete
                        Account</button>
                    <button type="button" class="btn btn-outline-warning mx-auto"
                        onclick="state.back();">Cancel</button>
                </div>
        </div>
        </h1>
    </div>

    <div class="row connected_content" id="profile"
        style="display: none; position:absolute; left:0px; top:0px; width:100%; height:100%;">
        <div class="col-xs-0 col-sm-1 col-md-2 col-lg-3">
        </div>
        <div class="col-xs-12 col-sm-10 col-md-8 col-lg-6">
            <h1
                style="padding: 18px; text-align:center; color:#fff; font-size: 18px !important; width:auto; background-color: rgba(0,0,0,.75); border-radius: 12px; border: 1px solid #fff !important;">
                Here you can manage your account settings.
                <br>
                <br>
                <div style="text-align: center;">
                    <button type="button" class="btn btn-outline-warning mx-auto"
                        onclick="state.show_page(pages.REQUEST);">Reset
                        Password</button>
                    <button type="button" class="btn btn-outline-danger mx-auto"
                        onclick="state.show_page(pages.DELETE_ACCOUNT);">Delete Account</button>
                </div>
            </h1>
        </div>
        <div class="col-xs-0 col-sm-1 col-md-2 col-lg-3">
        </div>
    </div>
    <div class="row connected_content" id="query"
        style="display: none; position:absolute; left:0px; top:0px; width:100%; height:100%;">
        <div class="col-xs-0 col-sm-1 col-md-2 col-lg-3">
        </div>
        <div class="col-xs-12 col-sm-10 col-md-8 col-lg-6" style="text-align:center!important">
        </div>
        <div class="col-xs-0 col-sm-1 col-md-2 col-lg-3">
        </div>
    </div>

    <div class="row connected_content" id="login"
        style="display: none; position:absolute; left:0px; top:0px; width:100%; height:100%;">
        <div class="col-xs-0 col-sm-1 col-md-2 col-lg-3">
        </div>
        <div class="col-xs-12 col-sm-10 col-md-8 col-lg-6">
            <h1
                style="text-align:center; color:#fff; font-size: 18px !important; width:auto; background-color: rgba(0,0,0,.75); border-radius: 12px; border: 1px solid #fff !important;">
                <br>
                By signing in you agree to our privacy policy:
                <br>
                <br>

                <div style="text-align: center;">
                    <button type="button" class="btn btn-outline-primary mx-auto"
                        onclick="state.show_page(pages.POLICY);">View
                        Privacy Policy</button>
                </div>
                <br>
            </h1>
            <br>
            <h1
                style="text-align:center; color:#fff; font-size: 18px !important; width:auto; background-color: rgba(0,0,0,.75); border-radius: 12px; border: 1px solid #fff !important;">
                <br> You can sign in by entering your credentials below:<br><br>
                <div
                    style="display: inline-block; text-align:center; color:#fff; font-size: 18px !important; width:50%;">
                    Email or Name
                </div>
                <input type="text" style="display: inline-block; font-size: 18px !important; width:40%;"
                    class="form-control" id="login_name_or_email" placeholder="Email/Name">
                <br>
                <br>
                <div
                    style="display: inline-block; text-align:center; color:#fff; font-size: 18px !important; width:50%;">
                    Password
                </div>
                <input type="password" style="display: inline-block; font-size: 18px !important; width:40%;"
                    class="form-control" id="login_password" placeholder="Password">
                <br>
                <br>
                <div style="display: inline-block; text-align:center; min-width:50%; max-height:50% !important;">
                    <img style="display: inline-block; text-align:center; color:#fff; font-size: 18px !important; "
                        id="login_captcha">
                </div>
                <input type="text" style="display: inline-block; font-size: 18px !important; width:40%;"
                    class="form-control" id="login_captcha_input" placeholder="Captcha">
                <br>
                <br>
                <button type="button" class="btn btn-outline-success mx-auto" onclick="state.login()">Login</button>
                <br>
                <br>
            </h1>
            <br>
            <h1
                style="text-align:center; color:#fff; font-size: 18px !important; width:auto; background-color: rgba(0,0,0,.75); border-radius: 12px; border: 1px solid #fff !important;">
                <br>
                Not a member? Simply use the "Sign Up" section to register!
                <br>
                <br>
                <button type="button" class="btn btn-outline-primary mx-auto"
                    onclick="state.show_page(pages.SIGNUP);">Sign
                    Up</button>
                <br>
                <br>
            </h1>
            <br>
            <h1
                style="text-align:center; color:#fff; font-size: 18px !important; width:auto; background-color: rgba(0,0,0,.75); border-radius: 12px; border: 1px solid #fff !important;">
                <br>
                Forgot your password? Click below!
                <br>
                <br>
                <button type="button" class="btn btn-outline-warning mx-auto"
                    onclick="state.show_page(pages.REQUEST);">Reset
                    Password</button>
                <br>
                <br>
            </h1>
        </div>
        <div class="col-xs-0 col-sm-1 col-md-2 col-lg-3">
        </div>
    </div>
    <div class="row connected_content" id="signup"
        style="display: none; position:absolute; left:0px; top:0px; width:100%; height:100%;">
        <div class="col-xs-0 col-sm-1 col-md-2 col-lg-3">
        </div>
        <div class="col-xs-12 col-sm-10 col-md-8 col-lg-6">
            <h1
                style="text-align:center; color:#fff; font-size: 18px !important; width:auto; background-color: rgba(0,0,0,.75); border-radius: 12px; border: 1px solid #fff !important;">
                <br>
                By signing up you agree to our privacy policy:
                <br>
                <br>

                <div style="text-align: center;">
                    <button type="button" class="btn btn-outline-primary mx-auto"
                        onclick="state.show_page(pages.POLICY);">View
                        Privacy Policy</button>
                </div>
                <br>
                You can sign up by giving us the following information, and using the password reset link
                you
                receive in
                your inbox.
                <br>
                <br>

                <div
                    style="display: inline-block; text-align:center; color:#fff; font-size: 18px !important; width:50%;">
                    Your Name
                </div>
                <input type="text" style="display: inline-block; font-size: 18px !important; width:40%;"
                    class="form-control" id="signup_name" placeholder="User Name">


                <br>
                <br>
                <div
                    style="display: inline-block; text-align:center; color:#fff; font-size: 18px !important; width:50%;">
                    Your Email</div>
                <input type="text" style="display: inline-block; font-size: 18px !important; width:40%;"
                    class="form-control" id="signup_email" placeholder="Email">
                <br>
                <br>

                <div style="display: inline-block; width:50%">
                    <img style="display: inline-block; text-align:center; color:#fff; font-size: 18px !important; height:50%;"
                        id="signup_captcha">
                </div>
                <input type="text" style="display: inline-block; font-size: 18px !important; width:40%;"
                    class="form-control" id="signup_captcha_input" placeholder="Captcha">
                <br>
                <br>
                <button type="button" class="btn btn-outline-success mx-auto" onclick="state.register()">Sign
                    Up</button>
                <br>
                <br>
            </h1>
            <br>

            <h1
                style="text-align:center; color:#fff; font-size: 18px !important; width:auto; background-color: rgba(0,0,0,.75); border-radius: 12px; border: 1px solid #fff !important;">
                <br>
                Already a member? Simply click "Login"!
                <br>
                <br>
                <button type="button" class="btn btn-outline-success mx-auto"
                    onclick="state.show_page(pages.LOGIN);">Login</button>
                <br>
                <br>
            </h1>
            <br>
            <h1
                style="text-align:center; color:#fff; font-size: 18px !important; width:auto; background-color: rgba(0,0,0,.75); border-radius: 12px; border: 1px solid #fff !important;">
                <br>
                Forgot your password? Click below!
                <br>
                <br>
                <button type="button" class="btn btn-outline-warning mx-auto"
                    onclick="state.show_page(pages.REQUEST);">Reset
                    Password</button>
                <br>
                <br>
            </h1>
        </div>
        <div class="col-xs-0 col-sm-1 col-md-2 col-lg-3">
        </div>
    </div>
    </div>

    <div fixed id="iframeDiv"
        style="position: fixed; top: 0px; left: 0px; right: 0px; bottom: 0px; height: 100%; width: 100%; z-index: -1;">
    </div>

    <script>
        function round(num, places) {
            var multiplier = Math.pow(10, places);
            return Math.round(num * multiplier) / multiplier;
        }

        function load_tree(onload_callback) {
            var iframe = document.createElement("iframe");
            iframe.onload = on_resources_loaded;
            iframe.sandbox = "allow-scripts";
            iframe.style.border = "0px";
            iframe.style.margin = "0px !important";

            iframe.style.position = "fixed"
            iframe.style.top = "0px"
            iframe.style.left = "0px"
            iframe.style.right = "0px"
            iframe.style.bottom = "0px"
            iframe.style.height = "100%"
            iframe.style.width = "100%"
            iframe.style.zIndex = "-1"
            iframe.src = "canvas.html";
            document.getElementById('iframeDiv').appendChild(iframe);
        }

        //Utility functions
        function getQueryVariable(variable) {
            var query = window.location.search.substring(1);
            var vars = query.split('&');
            for (var i = 0; i < vars.length; i++) {
                var pair = vars[i].split('=');
                if (decodeURIComponent(pair[0]) == variable) {
                    return decodeURIComponent(pair[1]);
                }
            }
            return null;
        }

        //Read URI
        var user_query_param = getQueryVariable("user");
        var code_query_param = getQueryVariable("code");
        var initial_path = window.location.hash;

        //Protocol Buffer Types
        var Message = null;
        var User = null;
        var Captcha = null;

        const MENU = "#menu"

        const pages = {
            RECONNECT: "#reconnect",
            PROCESSING: "#processing",
            RESET: "#reset",
            POLICY: "#policy",
            LOGOUT: "#logout",
            DELETE_ALGORITHM: "#delete_algorithm",
            REQUEST: "#request",
            CLIENT_ERROR: "#client_error",
            SERVER_ERROR: "#server_error",
            HOME: "#home",
            BROWSE: "#browse",
            EDIT: "#edit",
            CREATE: "#create",
            DELETE_ACCOUNT: "#delete_account",
            PROFILE: "#profile",
            LOGIN: "#login",
            SIGNUP: "#signup",
        }
        function is_message_page(page_name) {
            return page_name == pages.CLIENT_ERROR ||
                page_name == pages.SERVER_ERROR ||
                page_name == pages.PROCESSING;
        }
        function Video() {
            this.data = null;
            this.extension = null;
            this.name = "";
        }

        function GlobalState() {
            this.logged_in = false;
            this.user_name = "";
            this.user_email = ""
            this.user_password = ""
            this.websocket = null;
            this.protocol = null;
            this.last_captcha = null;
            this.current_page_state = null;
            this.local_file = null;
            this.video = new Video();
            this.result = null;
            this.page_history = []
            this.first_connection = true;
            this.page_transitions = [];
            this.deleting_algorithm = false;
        }
        GlobalState.prototype.post_connect_load = function () {

            var routed = false
            for (var p in pages) {
                var page = pages[p];
                if (page.toLowerCase() == initial_path.toLowerCase()) {
                    if (page == pages.RESET && this.first_connection && user_query_param && code_query_param) {
                        this.user_name = user_query_param;
                        this.show_page(pages.RESET, null, null, true, false);
                        this.show_page(pages.PROCESSING, "Validatings...", "Please be patient.", false);
                        this.send(Message.encode({
                            type: Message.Type.VALIDATE,
                            auth: {
                                user: user_query_param,
                                email: "",
                                password: "",
                            },
                            captcha: {
                                key: code_query_param
                            }
                        }).finish())
                        routed = true;
                    }
                    else if (
                        page != pages.RECONNECT &&
                        page != pages.PROCESSING &&
                        page != pages.RESET &&
                        //page != pages.POLICY &&
                        page != pages.LOGOUT &&
                        //page != pages.REQUEST &&
                        page != pages.CLIENT_ERROR &&
                        page != pages.SERVER_ERROR &&
                        page != pages.HOME &&
                        page != pages.EDIT &&
                        page != pages.QUERY &&
                        page != pages.CREATE_QUERY &&
                        page != pages.DELETE_ACCOUNT &&
                        page != pages.PROFILE) {
                        this.show_page(page);
                        // this.apply_page_change(function (state, title, page) {
                        //     window.history.replaceState(state, title, window.location.protocol + "//" + window.location.host + page);
                        // }.bind(this));
                        routed = true;
                    }
                    break;
                }
            }
            if (!routed) {
                this.back();//show_page(pages.HOME);
            }
            this.first_connection = false;
            //$(".connected_content").css("visibility", "visible");
            this.show_logged_out_content();
        }
        GlobalState.prototype.wait_for_proto_and_connect = function () {
            protobuf.load("proto/messages.proto", function (err, root) {
                if (err)
                    throw err;

                // Obtain a message type
                this.protocol = root;
                Message = this.protocol.lookupType("messages.Message");
                Auth = this.protocol.lookupType("messages.Auth");
                Captcha = this.protocol.lookupType("messages.Captcha");
                this.show_page(pages.PROCESSING, "Connecting...", "Please be patient.", false, true);
                this.connect();
            }.bind(this));
        }
        GlobalState.prototype.reconnect = function () {
            this.back(false);
            this.show_page(pages.PROCESSING, "Reconnecting...", "Please be patient.", false, true);
            this.connect();
        }
        GlobalState.prototype.connect = function () {
            this.websocket = new WebSocket("wss://" + window.location.hostname);

            this.websocket.binaryType = "arraybuffer";
            this.websocket.onclose = function (event) {
                this.logged_in = false;
                //$(".connected_content").css("visibility", "hidden");
                this.show_logged_out_content();
                this.page_history = [];
                this.show_page(pages.LOGIN, null, null, null, false);
                this.show_page(pages.RECONNECT, null, null, true, false)
                this.show_page(pages.CLIENT_ERROR, "Connection closed. Code: " + event.code, "If you were logged in, you are now logged out.", true, true);
            }.bind(this)
            this.websocket.onmessage = function (event) {
                try {
                    var decoded = Message.decode(new Uint8Array(event.data));
                    this.handle_message(decoded);
                }
                catch (e) {
                    this.show_page(pages.CLIENT_ERROR, "Error! Could not decode server response", e + "", true);
                }
            }.bind(this);
            this.websocket.onopen = function () {
                /*
                $(".disconnected_content").css("visibility", "visible");
                
                if (this.websocket && this.websocket.readyState == WebSocket.OPEN)
                    $(".connected_content").css("visibility", "visible");
                else
                    $(".connected_content").css("visibility", "hidden");
                */
                if (!this.first_connection)
                    this.back();
                this.post_connect_load()
            }.bind(this);

            //$(".disconnected_content").css("visibility", "visible");
        }

        GlobalState.prototype.send = function (encoded, request_updates = false) {
            this.websocket.send(encoded.length);

            if (request_updates)
                this.websocket.send(1);
            else
                this.websocket.send(0);
            var fragment_size = 1024 * 512;
            for (var i = 0; i < encoded.length; i += fragment_size) {
                var start = i;
                var end = i + fragment_size;
                this.websocket.send(encoded.subarray(start, end));
            }
        }
        GlobalState.prototype.refresh_captchas = function () {
            if (this.websocket && this.websocket.readyState == WebSocket.OPEN)
                this.send(Message.encode({ type: Message.Type.CAPTCHA }).finish());
        }

        GlobalState.prototype.handle_message = function (proto) {
            console.log(proto);

            if (proto.type == Message.Type.LOGIN) {
                this.user_name = proto.auth.user;
                this.user_email = proto.auth.email;
                //this.user_password = proto.auth.password;
                this.hash = proto.auth.hash;
                this.logged_in = true;
                this.show_page(pages.HOME);
            }
            if (proto.type == Message.Type.AUTH) {
                this.hash = proto.auth.hash;
            }
            else if (proto.type == Message.Type.SET_PASSWORD) {
                this.show_page(pages.PROCESSING, proto.message, proto.details, true, true);
            }
            else if (proto.type == Message.Type.HALT) {
                this.show_page(pages.PROCESSING, proto.message, proto.details, false, true);
            }
            else if (proto.type == Message.Type.PROGRESS) {
                if (this.deleting_algorithm) {
                    return;
                }
                this.show_page(pages.PROCESSING, proto.message, proto.details, true, true);
                this.video.data = null;
                this.redraw_edit_form();
            }
            else if (proto.type == Message.Type.DELETE_ALGORITHM) {
                if (this.deleting_algorithm) {
                    this.deleting_algorithm = false;
                }
                this.back(false);
                this.show_page(pages.PROCESSING, proto.message, proto.details, true, true);
                this.redraw_edit_form();
            }
            else if (proto.type == Message.Type.ERROR) {
                this.show_page(pages.SERVER_ERROR, proto.message, proto.details, true, true);
            }
            else if (proto.type == Message.Type.CAPTCHA) {


                var base_64_encoded = btoa(String.fromCharCode.apply(null, proto.captcha.image));

                this.unfiltered_captcha_image = document.createElement('img');
                this.unfiltered_captcha_image.onload = (function () {
                    var canvas = document.createElement('canvas');
                    canvas.width = this.unfiltered_captcha_image.width;
                    canvas.height = this.unfiltered_captcha_image.height;

                    var ctx = canvas.getContext("2d");

                    ctx.drawImage(this.unfiltered_captcha_image, 0, 0);
                    ctx.globalCompositeOperation = 'difference';
                    ctx.fillStyle = 'white';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);

                    var image_data = ctx.getImageData(0, 0, canvas.width, canvas.height);
                    for (var i = 0; i < image_data.data.length; i += 4) {
                        var max = Math.max(image_data.data[i], Math.max(image_data.data[i + 1], image_data.data[i + 2]));
                        if (max < 32) {
                            image_data.data[i + 3] = 0; // alpha
                        }
                        else {
                            image_data.data[i] /= .75;
                            image_data.data[i + 1] /= .75;
                            image_data.data[i + 2] /= .75;
                        }
                    }
                    ctx.putImageData(image_data, 0, 0);
                    var new_url = canvas.toDataURL();

                    $('#signup_captcha').attr('src', new_url);
                    $('#login_captcha').attr('src', new_url);
                    $('#reset_captcha').attr('src', new_url);
                    $('#request_captcha').attr('src', new_url);
                    $('#edit_captcha').attr('src', new_url);
                    $('#query_captcha').attr('src', new_url);
                    $('#delete_account_captcha').attr('src', new_url);

                    $('#signup_captcha_input').val("");
                    $('#login_captcha_input').val("");
                    $('#reset_captcha_input').val("");
                    $('#request_captcha_input').val("");
                    $('#edit_captcha_input').val("");
                    $('#query_captcha_input').val("");
                    $('#delete_account_captcha_input').val("");
                }).bind(this);
                this.unfiltered_captcha_image.src = `data:image/png;base64,${base_64_encoded}`

                this.last_captcha = proto.captcha;
            }
        }


        GlobalState.prototype.register = function () {
            var name = $("#signup_name").val();
            var valid_name = name.length >= 3;

            if (!valid_name) {
                this.show_page(pages.CLIENT_ERROR, "Error!", "Please enter a valid user name (use 3 or more characters).", true);
                return;
            }

            var email = $("#signup_email").val();
            var valid_email = /^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(email);

            if (!valid_email) {
                this.show_page(pages.CLIENT_ERROR, "Error!", "Please enter a valid email.", true);
                return;
            }

            var captcha = $("#signup_captcha_input").val();
            this.show_page(pages.PROCESSING, "Registering...", "Please be patient.", false, true);

            this.send(Message.encode({
                type: Message.Type.REGISTER,
                auth: {
                    user: name,
                    email: email,
                    password: ""
                },
                captcha: {
                    key: captcha
                }
            }).finish())
        }

        GlobalState.prototype.login = function () {
            var email_or_name = $("#login_name_or_email").val();
            var pwd = $("#login_password").val();
            var captcha = $("#login_captcha_input").val();


            this.show_page(pages.PROCESSING, "Logging in...", "Please wait...", false, true);
            this.send(Message.encode({
                type: Message.Type.LOGIN,
                auth: {
                    user: email_or_name,
                    email: email_or_name,
                    password: pwd
                },
                captcha: {
                    key: captcha
                }
            }).finish())
        }

        GlobalState.prototype.delete_account = function () {
            var value_entered = $("#login_name_or_email_delete").val()
            var captcha = $("#delete_account_captcha").val();
            if (this.user_name.toLowerCase() == (value_entered).toLowerCase() || this.user_email.toLowerCase() == (value_entered).toLowerCase()) {


                this.show_page(pages.PROCESSING, "Deleting account...", "Please wait...", false, true);
                this.send(Message.encode({
                    type: Message.Type.DELETE_ACCOUNT,
                    auth: {
                        user: this.user_name,
                        email: this.user_email,
                        hash: this.hash
                    },
                    captcha: {
                        key: captcha
                    }
                }).finish())
            }
        }
        GlobalState.prototype.logout = function () {
            if (this.websocket.readyState == WebSocket.OPEN) {
                this.show_page(pages.PROCESSING, "Logging out...", "Please wait...", false);
                this.websocket.close();
            }
        }

        GlobalState.prototype.send_request = function () {

            var name_or_email = $("#request_password_reset").val();
            var valid_name = name_or_email.length >= 3;
            var valid_email = /^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(name_or_email);

            if (!valid_name && !valid_email) {
                this.show_page(pages.CLIENT_ERROR, "Error!", "Please enter a valid name or email.", true);
                return;
            }

            var captcha = $("#request_captcha_input").val();


            this.show_page(pages.PROCESSING, "Sending request...", "Please wait...", false, true);
            this.send(Message.encode({
                type: Message.Type.REQUEST_PASSWORD_RESET,
                auth: {
                    user: name_or_email,
                    email: name_or_email,
                    password: ""
                },
                captcha: {
                    key: captcha
                }
            }).finish())
        }
        GlobalState.prototype.set_password = function () {
            var pwd = $("#reset_password").val()
            if (pwd != $("#reset_retype").val()) {
                this.show_page(pages.CLIENT_ERROR, "Error!", "Please enter passwords that match. Use at least one number, at least one letter, and at least six characters.", true);
                return;
            }
            var valid_pwd = /(?=.*\d)(?=.*[a-zA-Z]).{6,}/.test(pwd);
            if (!valid_pwd) {
                this.show_page(pages.CLIENT_ERROR, "Error!", "Please enter a valid password. Use at least one number, at least one letter, and at least six characters.", true);
                return;
            }

            var captcha = $("#reset_captcha_input").val();


            this.show_page(pages.PROCESSING, "Setting password...", "Please wait...", false, true);
            this.send(Message.encode({
                type: Message.Type.SET_PASSWORD,
                auth: {
                    user: this.user_name,
                    password: pwd
                },
                captcha: {
                    key: captcha
                }
            }).finish())
        }

        GlobalState.prototype.show_logged_out_content = function (new_page) {
            $.each($(".logged_in_content"), function () {
                if ($(this).is(":visible") && ($(new_page).has($(this)).length > 0 || $(this).parents().has(MENU).length > 0))
                    $(this).fadeOut(1000);
            });
            $.each($(".logged_out_content"), function () {
                if ($(this).is(":hidden") && ($(new_page).has($(this)).length > 0 || $(this).parents().has(MENU).length > 0))
                    $(this).fadeIn(1000);
            });
        }
        GlobalState.prototype.show_logged_in_content = function (new_page) {
            $.each($(".logged_in_content"), function () {
                //if($(this).is(":hidden") && 
                if (($(new_page).has($(this)).length > 0 || $(this).parents().has(MENU).length > 0))
                    $(this).fadeIn(1000);
            });
            $.each($(".logged_out_content"), function () {
                //if($(this).is(":visible") && 
                if (($(new_page).has($(this)).length > 0 || $(this).parents().has(MENU).length > 0))
                    $(this).fadeOut(1000);
            });
        }

        GlobalState.prototype.show_page = function (page = pages.HOME, message = null, subtext = null, opt_out = true, should_show_page = true, is_back_action = false) {

            if (this.moving) {
                show_page_params = [page, message, subtext, opt_out, should_show_page];
                this.page_transitions.push(show_page_params)
                return;
            }
            else if (is_message_page(this.current_page) && this.current_page_state.opt_out && !is_back_action) {
                var new_page_state =
                {
                    page: page,
                    message: message,
                    subtext: subtext,
                    opt_out: opt_out,
                    should_show_page: should_show_page
                };
                var top_page = this.page_history.pop()
                this.page_history = this.page_history.concat([new_page_state]).concat([top_page]);
                return;
            }
            else if (is_message_page(this.current_page) && !this.current_page_state.opt_out) {
                this.page_history.pop()
            }

            console.log("SHOWPAGE: " + page);

            var move_on = (() => {

                var new_page_state =
                {
                    page: page,
                    message: message,
                    subtext: subtext,
                    opt_out: opt_out,
                    should_show_page: should_show_page
                };
                var new_current_page = page;
                this.current_page_state =
                {
                    page: page,
                    message: message,
                    subtext: subtext,
                    opt_out: opt_out,
                    should_show_page: should_show_page
                };
                this.current_page = page;
                this.apply_page_change(function (page_state, title, page) {
                    window.history.pushState(page_state, title, window.location.protocol + "//" + window.location.host + page);
                }.bind(this));
                this.page_history.push(this.current_page_state)
                /*
 
                for (var i = floating_pages.length - 1; i >= 0; i--) {
                    var floating_page = this.page_history[floating_pages[i]]
                    this.current_page = floating_page.page;
                    this.apply_page_change(function (page_state, title, floating_page) {
                        window.history.pushState(page_state, title, window.location.protocol + "//" + window.location.host + page);
                    }.bind(this));
                    this.page_history.push(floating_page)
                }
 
                */
            }).bind(state);

            var transition = (() => {
                if (this.logged_in)
                    this.show_logged_in_content(page)
                else
                    this.show_logged_out_content(page);
                if (this.page_transitions.length > 0) {
                    var transition = this.page_transitions.shift()
                    this.show_page(transition[0],
                        transition[1],
                        transition[2],
                        transition[3],
                        transition[4]);
                }
            }).bind(state);
            var fill_content = (() => {
                switch (page) {
                    case pages.RECONNECT:
                        $("#menu").fadeOut(1000);
                        break;
                    case pages.PROCESSING:
                        $("#menu").fadeOut(1000);
                        $("#processing_header").text(message);
                        $("#processing_message").text(subtext);

                        if (opt_out)
                            $(".opt_out").fadeIn(1000);
                        else
                            $(".opt_out").fadeOut(1000);
                        break;
                    case pages.RESET:
                        this.refresh_captchas();
                        $("#menu").fadeOut(1000);
                        break;
                    case pages.POLICY:
                        $("#menu").fadeOut(1000);
                        break;
                    case pages.REQUEST:
                        this.refresh_captchas();
                        $("#menu").fadeOut(1000);
                        break;
                    case pages.CLIENT_ERROR:
                        $("#menu").fadeOut(1000);
                        $("#client_error_header").text(message);
                        $("#client_error_message").text(subtext);

                        if (opt_out)
                            $(".opt_out").fadeIn(1000);
                        else
                            $(".opt_out").fadeOut(1000);
                        break;
                    case pages.SERVER_ERROR:
                        $("#menu").fadeOut(1000);
                        $("#server_error_header").text(message);
                        $("#server_error_message").text(subtext);

                        if (opt_out)
                            $(".opt_out").fadeIn(1000);
                        else
                            $(".opt_out").fadeOut(1000);
                        break;
                    case pages.HOME:
                        $("#menu").fadeIn(1000);
                        break;
                    case pages.BROWSE:
                        $("#browse").fadeIn(1000);
                        $("#menu").fadeIn(1000);
                        break;
                    case pages.EDIT:
                        this.refresh_captchas();
                        this.redraw_edit_form();
                        $("#menu").fadeIn(1000);
                        break;
                    case pages.CREATE:
                        $("#create").fadeIn(1000);
                        $("#menu").fadeIn(1000);
                        break;
                    case pages.DELETE_ACCOUNT:
                        this.refresh_captchas();
                        $("#menu").fadeOut(1000);
                        break;
                    case pages.PROFILE:
                        $("#menu").fadeIn(1000);
                        break;
                    case pages.LOGIN:
                        this.refresh_captchas();
                        $("#menu").fadeIn(1000);
                        break;
                    case pages.SIGNUP:
                        this.refresh_captchas();
                        $("#menu").fadeIn(250);
                        break;
                }
                if (this.logged_in)
                    this.show_logged_in_content(page)
                else
                    this.show_logged_out_content(page);
            }).bind(state);

            /*
            var floating_pages = []
            for (var i = 0; i < this.page_history.length; i++) {
                var last_viable_page = this.page_history[i]
                if (is_message_page(last_viable_page.page) && last_viable_page.opt_out == true) {
                    floating_pages.push(i);
                }
            }
            var new_page_state =
            {
                page: page,
                message: message,
                subtext: subtext,
                opt_out: opt_out,
                should_show_page: should_show_page
            };
            var new_current_page = page;
            if(floating_pages.length > 0)
            {
                floating_start = this.page_history.length-floating_pages.length;
                this.page_history = this.page_history.slice(0, floating_start).concat([new_page_state]).concat(this.page_history.slice(floating_start));
            }
 
            else */
            if (this.current_page_state && (this.current_page_state.page != page || this.current_page_state.message != message || this.current_page_state.subtext != subtext)) {
                this.moving = true;

                var fade_in = ((page, should_show_page) => {
                    if (should_show_page) {
                        fill_content();

                        $(page).fadeIn(1000).promise().then(
                            (() => {
                                move_on()
                                this.moving = false;
                                transition()
                            }).bind(state)
                        );
                    }
                    else {
                        move_on()
                        this.moving = false;
                        transition()
                    }
                }).bind(state, page, should_show_page);

                if (this.current_page_state.page == page)
                    fade_in();
                else
                    $(this.current_page).fadeOut(1000).promise().then(fade_in);
            }
            else {
                this.moving = true;
                move_on()
                this.moving = false;
                fill_content();
                transition()
            }
        }
        GlobalState.prototype.apply_page_change = function (change_function) {
            var page = this.current_page;
            var message = "";
            switch (page) {
                case pages.RECONNECT:
                    message = "Reconnect";
                    break;
                case pages.PROCESSING:
                    message = "Processing";
                    break;
                case pages.RESET:
                    message = "Password Reset";
                    break;
                case pages.POLICY:
                    message = "Site Policies";
                    break;
                case pages.REQUEST:
                    message = "Request Password Reset";
                    break;
                case pages.CLIENT_ERROR:
                    message = "Client Error";
                    break;
                case pages.SERVER_ERROR:
                    message = "Server Error";
                    break;
                case pages.HOME:
                    message = "General Information";
                    break;
                case pages.BROWSE:
                    message = "Browse Algorithms";
                    break;
                case pages.EDIT:
                    message = "Edit Algorithm";
                    break;
                case pages.CREATE:
                    message = "Create Algorithm";
                    break;
                case pages.CREATE_QUERY:
                    message = "Create Visual Query";
                    break;
                case pages.DELETE_ACCOUNT:
                    message = "Delete Account";
                    break;
                case pages.PROFILE:
                    message = "Profile";
                    break;
                case pages.LOGIN:
                    message = "Log In";
                    break;
                case pages.SIGNUP:
                    message = "Sign Up";
                    break;
            }
            change_function(this.current_page_state, message, page);
        }

        GlobalState.prototype.redraw_profile_form = function () {
            // var edited_videos_table = "";

            // if (!this.profile_results || !this.profile_results.catalog || this.profile_results.catalog.length == 0) {
            //     $(".edit_present").fadeOut(1000);
            //     $(".edit_absent").fadeIn(1000);
            // }
            // else {
            //     $(".edit_present").fadeIn(1000);
            //     $(".edit_absent").fadeOut(1000);
            //     for (var i = 0; i < this.profile_results.catalog.videos.length; i++) {

            //         edited_videos_table +=
            //             `<tr>
            //         <th style="vertical-align: middle;">
            //             <img style="display: inline-block; text-align:center; color:#fff; font-size: 18px !important; max-height:128px;"
            //                         id="request_captcha" src="`+ this.profile_results.catalog.videos[i].thumbnail + `"></th>
            //         <th style="vertical-align: middle;"><br>"`+
            //             this.profile_results.catalog.videos[i].clientName + `"<br><br>` +
            //             `<button type="button" class="btn btn-outline-success mx-auto"
            //                 onclick="state.preview_profile_result(`+ i + `);">Preview</button>` + `<br><br>` +
            //             `<button type="button" class="btn btn-outline-danger mx-auto"
            //                 onclick="state.start_video_delete(`+ i + `);">Delete</button>` + `<br><br>` +
            //             `</th>
            //         </tr>`
            //     }

            //     $("#edited_videos_table").html(edited_videos_table)
            // }
        }
        GlobalState.prototype.start_video_delete = function (index) {
            window.delete_algorithm_index = index;
            this.show_page(pages.DELETE_ALGORITHM);
        }
        GlobalState.prototype.end_algorithm_delete = function () {
            this.show_page(pages.PROCESSING, "Deleting algorithm...", "Please be patient.", false, true);

            var json = {
                type: Message.Type.DELETE_ALGORITHM,
                auth: {
                    user: this.user_name,
                    hash: this.hash
                },
                video: {
                    serverName: this.profile_results.catalog.videos[window.delete_algorithm_index].serverName
                }
            }

            var encoded = Message.encode(json).finish();

            this.deleting_algorithm = true;
            this.send(encoded);
        }

        GlobalState.prototype.redraw_edit_form = function () {
        }

        GlobalState.prototype.back = function (show_page = true) {
            if (state.page_history.length == 0)
                this.show_page(pages.HOME)
            else {
                var last_viable_page = state.page_history.pop()
                if (state.page_history.length == 0) {
                    this.show_page(pages.HOME, null, null, true, true, true)
                    return;
                }
                last_viable_page = state.page_history.pop()
                while (state.page_history.length > 0 &&
                    (!last_viable_page.opt_out ||
                        last_viable_page.page == pages.LOGOUT))
                    last_viable_page = state.page_history.pop()

                this.show_page(last_viable_page.page,
                    last_viable_page.message,
                    last_viable_page.subtext,
                    last_viable_page.opt_out,
                    show_page, true);
            }
        }

        GlobalState.prototype.pop_page = function (pop_event) {
            this.current_page_state = pop_event ? pop_event.state : null;

            state.back();
        }

        window.onpopstate = function (event) {
            console.log(event);
            state.pop_page(event)
        };

        var on_resources_loaded = function () {
            console.log($)//Show me the money
            if (typeof $ == 'undefined' ||
                typeof $('[data-toggle="tooltip"]') == 'undefined' ||
                typeof $('[data-toggle="tooltip"]').tooltip == 'undefined' ||
                !protobuf)
                window.setTimeout(on_resources_loaded, 1000);
            else {
                $('[data-toggle="tooltip"]').tooltip();
                state = new GlobalState();
                state.wait_for_proto_and_connect()
            }
        }
        window.onload = function () {
            load_tree()
        }
    </script>
</body>

</html>